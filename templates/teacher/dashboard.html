<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Profile Tracker</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/teacher/dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0"></script> <!-- For box plot annotations -->
</head>
<body>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="logo">CodingProfile</div>
        <nav>
            <ul>
                <li class="active" > <span class="icon">üè†</span> <a href="/teacher/dashboard">Dashboard</a> </li>
                <li> <span class="icon">üìã</span> <a href="/teacher/assignments">Assignments</a> </li>
                <li><span class="icon">üßÆ</span><a href="/teacher/smarttable">Smart Table</a></li>
                <li> <span class="icon">üéØ</span> <a href="/teacher/set_goal">Set Goal</a> </li>
                <li><span class="icon">üë•</span><a href="/teacher/students">Students</a></li>
                <li class="logout"><span class="icon">üö™</span><a href="{{ url_for('logout') }}">Logout</a></li>
              </ul>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <header>
          <div class="welcome">
            <h1>Welcome, {{ user.name }}!</h1>
            <p>Manage assignments and students efficiently.</p>
          </div>
          <div class="user-avatar">
            <img src="{{ user.avatar_url }}" alt="User Avatar">
        </div>
        </header>

            <!-- Metrics Section -->
            <div class="content-section">
                <h2>Class LeetCode Performance Overview</h2>

                <!-- Summary Statistics -->
                <div class="summary-stats">
                    <h3>Summary Statistics</h3>
                    <div class="charts">
                        <!-- Total Problems Solved -->
                        <div class="chart-container">
                            <h3>Total Problems Solved</h3>
                            <p class="description">Distribution of total problems solved across all students.</p>
                            <canvas id="totalSolvedBoxPlot"></canvas>
                            <canvas id="totalSolvedHistogram"></canvas>
                        </div>
                        <!-- Weighted Score -->
                        <div class="chart-container">
                            <h3>Weighted Score</h3>
                            <p class="description">Distribution of weighted scores (Easy x 1 + Medium x 3 + Hard x 5).</p>
                            <canvas id="weightedScoreBoxPlot"></canvas>
                            <canvas id="weightedScoreHistogram"></canvas>
                        </div>
                        <!-- Peak Activity -->
                        <div class="chart-container">
                            <h3>Peak Submission Activity</h3>
                            <p class="description">Distribution of peak daily submissions.</p>
                            <canvas id="peakActivityBoxPlot"></canvas>
                            <canvas id="peakActivityHistogram"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Highlights -->
                <div class="highlights">
                    <h3>Performance Highlights</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Mean</th>
                                <th>Median</th>
                                <th>Top 3 Students</th>
                                <th>Bottom 3 Students</th>
                                <th>Top 10% Avg</th>
                                <th>Bottom 10% Avg</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metric, stats in summary_stats.items() %}
                            <tr>
                                <td>{{ metric | replace('_', ' ') | title }}</td>
                                <td>{{ stats.mean }}</td>
                                <td>{{ stats.median }}</td>
                                <td>
                                    {% for name, value in highlights[metric].top_3 %}
                                    {{ name }} ({{ value }})<br>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for name, value in highlights[metric].bottom_3 %}
                                    {{ name }} ({{ value }})<br>
                                    {% endfor %}
                                </td>
                                <td>{{ highlights[metric].top_10_percent_avg }}</td>
                                <td>{{ highlights[metric].bottom_10_percent_avg }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for Charts and Controls -->
    <script>
        const histogramData = {{ summary_histograms | tojson | safe }};
        
        function renderHistogram(metric, canvasId) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const data = histogramData[metric];
            if (!data) return;
    
            const labels = data.bin_edges.map(edge => Math.round(edge));
            const values = data.histogram;
    
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.slice(0, -1), // One less than bin_edges
                    datasets: [{
                        label: metric + ' Distribution',
                        data: values,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    }]
                },
                options: {
                    scales: {
                        x: { title: { display: true, text: 'Score Range' }},
                        y: { title: { display: true, text: 'Number of Students' }}
                    }
                }
            });
        }
    
        window.onload = () => {
            renderHistogram('totalSolved', 'totalSolvedHistogram');
            renderHistogram('weightedScore', 'weightedScoreHistogram');
            renderHistogram('peakActivity', 'peakActivityHistogram');
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
