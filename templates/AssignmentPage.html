<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignments - DSA Progress Hub</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/AssignmentPage.css') }}">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM11 7H13V13H11V7ZM11 15H13V17H11V15Z" fill="#6B7280"/>
            </svg>
            <span>DSA Progress Hub</span>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li class="active">
                    <a href="/teacher_assignments">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="#F9A8A8"/>
                        </svg>
                        Assignments
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header>
            <h1>Assignments</h1>
            <div class="header-actions">
                <div class="tabs">
                    <a href="/dashboard" class="btn btn-secondary">
                        Back
                    </a>
                    <button class="tab active">Active</button>
                    <button class="tab">Archive</button>
                </div>
                <button class="btn btn-primary">Create Assignment</button>
            </div>
        </header>

        <!-- Assignments Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Due Date</th>
                        <th>Completion Rate</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assignment in assignments %}
                    <tr>
                        <td><a href="/assignment/{{ assignment.id }}">{{ assignment.name }}</a></td>
                        <td>{{ assignment.due_date }}</td>
                        <td><div class="progress-bar"><span style="width: {{ assignment.completion_rate }}%;"></span></div></td>
                        <td><span class="status {{ assignment.status }}">{{ assignment.status | replace('-', ' ') | capitalize }}</span></td>
                        <td>
                            <div class="action-dropdown">
                                <span class="actions" onclick="toggleDropdown(this)">â‹®</span>
                                <div class="dropdown-content" id="dropdown-{{ loop.index }}">
                                    <form class="update-deadline" action="/assignment/{{ assignment.id }}/update_deadline" method="POST">
                                        <input type="date" name="new-deadline" required>
                                        <button type="submit">Update</button>
                                    </form>
                                    <a href="#" onclick="viewDetails('{{ assignment.id }}')">View Details</a>
                                    <form action="/assignment/{{ assignment.id }}/archive" method="POST" onsubmit="return confirm('Are you sure you want to archive {{ assignment.name }}?')">
                                        <button type="submit">Archive</button>
                                    </form>
                                    <form action="/assignment/{{ assignment.id }}/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete {{ assignment.name }}? This action cannot be undone.')">
                                        <button type="submit">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <!-- JavaScript for dropdown and actions -->
    <script>
        function toggleDropdown(element) {
            const dropdown = element.nextElementSibling;
            const isOpen = dropdown.style.display === 'block';
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none');
            dropdown.style.display = isOpen ? 'none' : 'block';
        }

        function viewDetails(assignmentId) {
            window.location.href = `/assignment/${assignmentId}`;
            toggleDropdown(event.target.closest('.action-dropdown').querySelector('.actions'));
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdowns = document.querySelectorAll('.dropdown-content');
            dropdowns.forEach(dropdown => {
                if (!dropdown.contains(event.target) && !event.target.classList.contains('actions')) {
                    dropdown.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>